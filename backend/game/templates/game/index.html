{% load static %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>县令模拟器</title>
  <link rel="stylesheet" href="{% static 'game/css/main.css' %}">
</head>
<body>

<!-- ==================== Screen 1: Login ==================== -->
<section id="screen-login" class="screen active">
  <div class="login-box">
    <h1>县令模拟器</h1>
    <p class="subtitle">治一方水土，安一方百姓</p>
    <form id="login-form">
      <input type="text" id="login-username" placeholder="用户名" required autocomplete="username">
      <input type="password" id="login-password" placeholder="密码" required autocomplete="current-password">
      <button type="submit" class="btn btn-primary">登录</button>
      <p id="login-error" class="error-msg hidden"></p>
    </form>
    <p class="hint">账号请通过管理后台创建</p>
  </div>
</section>

<!-- ==================== Screen 2: Game List ==================== -->
<section id="screen-game-list" class="screen hidden">
  <div class="top-bar">
    <h2>我的游戏</h2>
    <div class="top-bar-right">
      <span id="username-display"></span>
      <button id="btn-logout" class="btn btn-small">登出</button>
    </div>
  </div>

  <div class="new-game-panel">
    <h3>开始新游戏</h3>
    <p>选择出身背景：</p>
    <div class="background-choices">
      <button class="btn btn-background" data-bg="HUMBLE">
        <strong>寒门子弟</strong>
        <span>知识3 / 技能3</span>
      </button>
      <button class="btn btn-background" data-bg="SCHOLAR">
        <strong>书香门第</strong>
        <span>知识5 / 技能3</span>
      </button>
      <button class="btn btn-background" data-bg="OFFICIAL">
        <strong>官宦之后</strong>
        <span>知识4 / 技能5</span>
      </button>
    </div>
  </div>

  <div id="game-list-container">
    <h3>已有存档</h3>
    <div id="game-list"></div>
  </div>
</section>

<!-- ==================== Screen 3: Game Play ==================== -->
<section id="screen-game" class="screen hidden">
  <!-- Header -->
  <div class="game-header">
    <button id="btn-back-to-list" class="btn btn-small">返回列表</button>
    <div class="header-info">
      <span id="season-display"></span>
      <span id="treasury-display"></span>
    </div>
  </div>

  <!-- Tab Navigation -->
  <nav class="tab-nav">
    <button class="tab-btn active" data-tab="tab-dashboard">县情总览</button>
    <button class="tab-btn" data-tab="tab-villages">村庄</button>
    <button class="tab-btn" data-tab="tab-actions">施政</button>
    <button class="tab-btn" data-tab="tab-report">季报</button>
  </nav>

  <!-- Tab: Dashboard -->
  <div id="tab-dashboard" class="tab-content active">
    <div id="stats-grid" class="stats-grid"></div>
    <div id="info-row" class="info-row"></div>
    <div id="environment-info"></div>
    <div id="disaster-alert" class="disaster-alert hidden"></div>
    <div id="investments-list"></div>
    <div id="markets-info"></div>
    <div id="player-info"></div>
  </div>

  <!-- Tab: Villages -->
  <div id="tab-villages" class="tab-content hidden">
    <table id="village-table" class="data-table">
      <thead>
        <tr>
          <th>村庄</th>
          <th>人口</th>
          <th>耕地(亩)</th>
          <th>地主占比</th>
          <th>民心</th>
          <th>治安</th>
          <th>村塾</th>
        </tr>
      </thead>
      <tbody id="village-tbody"></tbody>
    </table>
  </div>

  <!-- Tab: Actions -->
  <div id="tab-actions" class="tab-content hidden">
    <div class="action-section">
      <h3>税率调整</h3>
      <div class="tax-control">
        <input type="range" id="tax-slider" min="9" max="15" step="1" value="12">
        <span id="tax-display">12%</span>
        <button id="btn-set-tax" class="btn btn-primary btn-small">确认调整</button>
      </div>
    </div>

    <div class="action-section">
      <h3>投资施政</h3>
      <div id="invest-cards" class="invest-grid"></div>
    </div>

    <!-- Village target modal -->
    <div id="village-modal" class="modal hidden">
      <div class="modal-content">
        <h4 id="modal-title">选择目标村庄</h4>
        <select id="modal-village-select"></select>
        <div class="modal-actions">
          <button id="modal-confirm" class="btn btn-primary btn-small">确认</button>
          <button id="modal-cancel" class="btn btn-small">取消</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab: Report -->
  <div id="tab-report" class="tab-content hidden">
    <div id="report-content">
      <p class="hint">推进季度后将在此显示季报</p>
    </div>
    <button id="btn-advance" class="btn btn-primary btn-advance">推进季度</button>
  </div>
</section>

<!-- ==================== Screen 4: End Summary ==================== -->
<section id="screen-summary" class="screen hidden">
  <div class="summary-box">
    <h2>任期结束</h2>
    <div id="summary-stats"></div>
    <div id="summary-villages"></div>
    <button id="btn-back-from-summary" class="btn btn-primary">返回游戏列表</button>
  </div>
</section>

<!-- ==================== Toast Container ==================== -->
<div id="toast-container"></div>

<!-- Scripts -->
<script src="{% static 'game/js/api.js' %}"></script>
<script src="{% static 'game/js/state.js' %}"></script>
<script src="{% static 'game/js/components.js' %}"></script>
<script src="{% static 'game/js/screens.js' %}"></script>
<script src="{% static 'game/js/app.js' %}"></script>

</body>
</html>
