# 03 — 事件系统设计

---

## 1. 事件分类总览

| 类型 | 触发方式 | 频率 | 特点 |
|------|---------|------|------|
| 常规事件 | 每季度固定触发 | 每季度1个 | 可预期，构成施政节奏骨架 |
| 随机事件 | 概率触发，受指标影响 | 每季度0-1个 | 考验应变，增加不确定性 |
| 链式事件 | 由前序决策触发 | 不定 | 核心策略深度来源 |
| 对话事件 | 特定条件下触发 | 每年2-4次 | AI对话交互，核心趣味 |

---

## 2. 事件数据结构

```json
{
  "event_id": "EVT_DROUGHT_001",
  "name": "夏旱",
  "type": "random",
  "season": "summer",
  "trigger_conditions": {
    "probability_base": 0.15,
    "modifiers": [
      { "condition": "has_irrigation", "modifier": -0.08 },
      { "condition": "weather_dry_spring", "modifier": +0.10 }
    ]
  },
  "description": "入夏以来滴雨未下，{village_name}等村庄庄稼枯黄，百姓人心惶惶。",
  "options": [
    {
      "id": "A",
      "text": "开仓放粮，安抚百姓",
      "cost": { "cash": 80 },
      "ap_cost": 1,
      "immediate_effects": { "morale": +8, "cash": -80 },
      "delayed_effects": [],
      "agent_reactions": {
        "gentry": "不满——觉得县令在收买民心",
        "village_elder": "感激"
      }
    },
    {
      "id": "B",
      "text": "强制地主开仓赈济",
      "cost": {},
      "ap_cost": 2,
      "immediate_effects": { "morale": +12, "gentry_cooperation": -20 },
      "delayed_effects": [
        { "trigger_event": "EVT_GENTRY_REVENGE_001", "delay_seasons": 3, "probability": 0.6 }
      ],
      "agent_reactions": {
        "gentry": "愤怒——考虑向上级告状",
        "village_elder": "非常感激"
      }
    },
    {
      "id": "C",
      "text": "向知府申请赈灾拨款",
      "cost": {},
      "ap_cost": 1,
      "immediate_effects": {},
      "delayed_effects": [],
      "requires_dialogue": true,
      "dialogue_target": "知府",
      "success_depends_on": ["知府好感度", "玩家辩才", "灾情严重程度"]
    }
  ],
  "no_action_consequences": {
    "morale": -15,
    "population": -50,
    "chain_event": "EVT_REFUGEE_001"
  }
}
```

---

## 3. 常规事件清单（每季度必触发1个）

### 春季
| 事件 | 核心决策 |
|------|---------|
| 春耕安排 | 分配种植计划：粮食(稳健) vs 经济作物(高收益高风险) |
| 年度预算制定 | 分配县库资金到各投资方向 |

### 夏季
| 事件 | 核心决策 |
|------|---------|
| 中央政令传达 | 新政策（加税/减税/徭役等）来了，如何执行 |
| 半年巡查 | 知府或其代表到访，汇报上半年工作 |

### 秋季
| 事件 | 核心决策 |
|------|---------|
| 秋收与征税 | 确定实际征收力度：足额/减免/超额 |
| 徭役摊派 | 中央下达徭役指标，分配到各村 |

### 冬季
| 事件 | 核心决策 |
|------|---------|
| 年终述职 | 向考核委员会汇报，对话事件 |
| 社交季 | 选择参加哪些聚会，拜访哪些人 |

---

## 4. 随机事件库（MVP 约20个）

### 天灾类
| 事件 | 基础概率 | 影响 |
|------|---------|------|
| 旱灾 | 15% | 产量-30%~-60%，需赈灾 |
| 水灾 | 10% | 产量-40%~-70%，基建损坏 |
| 蝗灾 | 8% | 产量-20%~-40% |
| 瘟疫 | 5% | 人口-5%~-15%，民心大降 |

### 治安类
| 事件 | 基础概率 | 触发加成 |
|------|---------|---------|
| 山贼袭扰 | 10% | 治安<40时+20% |
| 流民涌入 | 8% | 邻县灾害时+25% |
| 村庄械斗 | 12% | 土地纠纷未解决时+15% |

### 官场类
| 事件 | 基础概率 | 说明 |
|------|---------|------|
| 京官路过 | 10% | 接待方式影响上层印象 |
| 上级征兵 | 15% | 强制事件，影响人口和民心 |
| 密旨调查 | 5% | 朝廷派人暗访，施政记录被审视 |
| 同僚求助 | 12% | 邻县县令请求借粮/人力 |

### 民间类
| 事件 | 基础概率 | 说明 |
|------|---------|------|
| 土地纠纷案 | 20% | 对话事件，审案 |
| 地主兼并 | 15% | 地主试图低价购买灾民土地 |
| 商户纠纷 | 10% | 集市商户之间的矛盾 |
| 奇人异事 | 5% | 趣味性事件（游方郎中/奇书/民间发明） |

---

## 5. 链式事件设计

### 5.1 链式事件机制
- 某些决策会在世界状态中埋下"种子"（delayed_effect标记）
- 每季度结算时检查所有种子是否到达触发时间
- 到达后按概率决定是否实际触发

### 5.2 核心因果链示例

**链条A：得罪地主 → 考核打压**
```
第1年春：地主兼并案，玩家判地主败诉
    ↓ [种子：地主报复，延迟2-4季度]
第1年冬或第2年：地主通过省级关系向吏部侍郎施压
    ↓
第3年冬：年终考核中，吏部代表给出负面评价
```

**链条B：修水利 → 丰收 → 声望提升**
```
第1年春：投资修建水利（花费100两）
    ↓ [2年后见效]
第3年秋：亩产提升20%，税收增加
    ↓
第3年冬：政绩突出，考核加分 + 可能触发"能吏之名"声望事件
```

**链条C：减税惠民 → 上级不满 → 补税压力**
```
第1年秋：主动减免部分农业税
    ↓ [种子：上缴不足]
第2年春：知府发函质询税收缺口
    ↓ 选择：补缴(损失县库) / 据理力争(消耗知府好感) / 造假(风险极高)
```

**链条D：过度开垦 → 生态退化**
```
第1年：连续开垦荒地2次
    ↓ [种子：水土流失，延迟3年]
第3年：该区域耕地产量下降15%，且旱灾概率+10%
```

---

## 6. 对话事件设计

### 6.1 对话事件特点
- 玩家与AI Agent进行自由文本对话（非选项）
- AI Agent基于人设和当前状态即时反应
- 对话结果由AI根据双方论点质量判定
- 每次对话限制回合数（3-8轮），防止无限拖延

### 6.2 对话事件类型

| 场景 | 对象 | 玩家目标 | Agent态度 |
|------|------|---------|----------|
| 审案 | 原被告双方 | 查明真相，公正判决 | 各执一词，可能撒谎 |
| 减税谈判 | 知府 | 争取税收减免 | 看政绩、好感度、自身压力 |
| 赈灾动员 | 地主 | 说服地主出资赈灾 | 看性格、利益、威胁 |
| 年终述职 | 考核委员 | 展示政绩，留下好印象 | 有预设偏好，问刁钻问题 |
| 接待京官 | 路过京官 | 建立关系，避免得罪 | 可能傲慢、可能平和 |
| 幕僚谏言 | 师爷 | 获取建议 | 基于师爷专长给出分析 |

### 6.3 对话结果判定
- AI Agent在对话结束后内部评估玩家表现
- 评估维度：论点有效性、态度是否得体、是否触及Agent核心关切
- 输出：成功/部分成功/失败 + 态度变化值

---

## 7. 事件调度系统

### 7.1 每季度事件流程
```
1. 触发该季度的常规事件
2. 检查链式事件种子是否到期 → 概率判定是否触发
3. 计算随机事件池 → 按概率选择0-1个触发
4. 所有事件排入队列，按优先级（强制>链式>随机>常规）展示给玩家
5. 玩家处理事件（消耗AP）
6. 未处理的非强制事件自动按"不作为"结算
```

### 7.2 事件密度控制
- 每季度最多处理3个事件（含强制事件）
- 如果强制事件已占满3个行动点，其他事件延后或自动结算
- 灾难性事件（如瘟疫）可突破密度上限
